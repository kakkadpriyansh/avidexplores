"use strict";(()=>{var e={};e.id=5382,e.ids=[5382],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},83634:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>I,requestAsyncStorage:()=>f,routeModule:()=>v,serverHooks:()=>x,staticGenerationAsyncStorage:()=>h});var s={};r.r(s),r.d(s,{GET:()=>m,POST:()=>g});var n=r(49303),i=r(88716),a=r(60670),o=r(87070),d=r(14184),u=r(11185),p=r.n(u);let c=new u.Schema({userId:{type:u.Schema.Types.ObjectId,ref:"User",required:[!0,"User ID is required"]},eventId:{type:u.Schema.Types.ObjectId,ref:"Event",required:[!0,"Event ID is required"]},bookingId:{type:u.Schema.Types.ObjectId,ref:"Booking",required:[!0,"Booking ID is required"]},rating:{type:Number,required:[!0,"Rating is required"],min:[1,"Rating must be at least 1"],max:[5,"Rating cannot exceed 5"]},review:{type:String,required:[!0,"Review is required"],trim:!0,minlength:[10,"Review must be at least 10 characters"],maxlength:[1e3,"Review cannot exceed 1000 characters"]},title:{type:String,trim:!0,maxlength:[100,"Title cannot exceed 100 characters"]},images:[{type:String}],approved:{type:Boolean,default:!1},isPublic:{type:Boolean,default:!0},isFeatured:{type:Boolean,default:!1},helpfulVotes:[{type:u.Schema.Types.ObjectId,ref:"User"}],adminResponse:{message:{type:String,trim:!0,maxlength:[500,"Admin response cannot exceed 500 characters"]},respondedBy:{type:u.Schema.Types.ObjectId,ref:"User"},respondedAt:{type:Date}}},{timestamps:!0});c.index({userId:1,eventId:1},{unique:!0}),c.index({eventId:1}),c.index({approved:1}),c.index({isFeatured:1}),c.index({rating:-1}),c.index({createdAt:-1});let l=p().models.Testimonial||p().model("Testimonial",c);async function m(e){try{await (0,d.Z)();let{searchParams:t}=new URL(e.url),r=parseInt(t.get("page")||"1"),s=parseInt(t.get("limit")||"10"),n=t.get("eventId"),i=t.get("featured"),a={isApproved:!0,isPublic:!0};n&&(a.eventId=n),"true"===i&&(a.isFeatured=!0);let u=(r-1)*s,p=await l.find(a).populate("userId","name").populate("eventId","title slug").sort({isFeatured:-1,createdAt:-1}).skip(u).limit(s).select("-adminResponse"),c=await l.countDocuments(a);return o.NextResponse.json({success:!0,data:p,pagination:{page:r,limit:s,total:c,pages:Math.ceil(c/s)}})}catch(e){return console.error("Error fetching testimonials:",e),o.NextResponse.json({success:!1,error:"Failed to fetch testimonials"},{status:500})}}async function g(e){try{await (0,d.Z)();let{eventId:t,bookingId:r,rating:s,review:n,title:i,images:a}=await e.json();if(!t||!s||!n)return o.NextResponse.json({success:!1,error:"Event ID, rating, and review are required"},{status:400});if(s<1||s>5)return o.NextResponse.json({success:!1,error:"Rating must be between 1 and 5"},{status:400});let u=await l.create({userId:"507f1f77bcf86cd799439011",eventId:t,bookingId:r,rating:s,review:n,title:i,images:a||[],isApproved:!1,isPublic:!0}),p=await l.findById(u._id).populate("userId","name").populate("eventId","title slug");return o.NextResponse.json({success:!0,data:p,message:"Testimonial submitted successfully. It will be visible after admin approval."},{status:201})}catch(e){return console.error("Error creating testimonial:",e),o.NextResponse.json({success:!1,error:"Failed to create testimonial"},{status:500})}}let v=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/testimonials/route",pathname:"/api/testimonials",filename:"route",bundlePath:"app/api/testimonials/route"},resolvedPagePath:"/Users/priyanshkakkad/Downloads/avid-explores-frontend-main/src/app/api/testimonials/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:h,serverHooks:x}=v,y="/api/testimonials/route";function I(){return(0,a.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:h})}},14184:(e,t,r)=>{r.d(t,{Z:()=>o});var s=r(11185),n=r.n(s);let i=process.env.MONGODB_URI;if(!i)throw Error("Please define the MONGODB_URI environment variable inside .env.local (development) or .env.production (production)");let a=global.mongoose;a||(a=global.mongoose={conn:null,promise:null});let o=async function(){if(a.conn)return a.conn;a.promise||(a.promise=n().connect(i,{bufferCommands:!1}).then(e=>e));try{a.conn=await a.promise}catch(e){throw a.promise=null,e}return a.conn}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[9276,5972],()=>r(83634));module.exports=s})();