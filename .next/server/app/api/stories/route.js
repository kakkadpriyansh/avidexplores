"use strict";(()=>{var e={};e.id=9655,e.ids=[9655],e.modules={11185:e=>{e.exports=require("mongoose")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},69140:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>S,requestAsyncStorage:()=>y,routeModule:()=>g,serverHooks:()=>x,staticGenerationAsyncStorage:()=>h});var s={};r.r(s),r.d(s,{GET:()=>p,POST:()=>m});var a=r(49303),i=r(88716),n=r(60670),o=r(87070),l=r(14184),d=r(78638),u=r(75571),c=r(95456);async function p(e){try{await (0,l.Z)();let{searchParams:t}=new URL(e.url),r=parseInt(t.get("page")||"1"),s=parseInt(t.get("limit")||"10"),a=t.get("category"),i=t.get("featured"),n=t.get("search"),p=t.get("userId"),m=t.get("sortBy")||"publishedAt",g=t.get("sortOrder")||"desc",y=await (0,u.getServerSession)(c.Lz),h=y?.user?.role==="ADMIN"?{}:{isPublished:!0};a&&(h.category=a),"true"===i&&(h.isFeatured=!0),p&&(h.userId=p),n&&(h.$or=[{title:RegExp(n,"i")},{excerpt:RegExp(n,"i")},{tags:RegExp(n,"i")}]);let x=(r-1)*s,f=await d.Z.find(h).populate("userId","name avatar").populate("eventId","title slug").select("-content").sort({[m]:"desc"===g?-1:1}).skip(x).limit(s),S=await d.Z.countDocuments(h);return o.NextResponse.json({success:!0,data:f,pagination:{page:r,limit:s,total:S,pages:Math.ceil(S/s)}})}catch(e){return console.error("Error fetching stories:",e),o.NextResponse.json({success:!1,error:"Failed to fetch stories"},{status:500})}}async function m(e){try{await (0,l.Z)();let{title:t,content:r,excerpt:s,coverImage:a,images:i,tags:n,category:u,eventId:c,isPublished:p=!1}=await e.json();if(!t||!r||!s||!a||!u)return o.NextResponse.json({success:!1,error:"Title, content, excerpt, cover image, and category are required"},{status:400});let m=t.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");if(await d.Z.findOne({slug:m}))return o.NextResponse.json({success:!1,error:"Story with this title already exists"},{status:400});let g=new d.Z({title:t,slug:m,content:r,excerpt:s,coverImage:a,images:i||[],tags:n||[],category:u,userId:"507f1f77bcf86cd799439011",eventId:c||void 0,isPublished:p});await g.save();let y=await d.Z.findById(g._id).populate("userId","name avatar").populate("eventId","title slug");return o.NextResponse.json({success:!0,data:y,message:"Story created successfully"},{status:201})}catch(e){if(console.error("Error creating story:",e),"ValidationError"===e.name){let t=Object.values(e.errors).map(e=>e.message);return o.NextResponse.json({success:!1,error:t.join(", ")},{status:400})}return o.NextResponse.json({success:!1,error:"Failed to create story"},{status:500})}}let g=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/stories/route",pathname:"/api/stories",filename:"route",bundlePath:"app/api/stories/route"},resolvedPagePath:"/Users/priyanshkakkad/Downloads/avid-explores-frontend-main/src/app/api/stories/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:y,staticGenerationAsyncStorage:h,serverHooks:x}=g,f="/api/stories/route";function S(){return(0,n.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:h})}},95456:(e,t,r)=>{r.d(t,{Lz:()=>p}),r(41482);var s=r(53797),a=r(14184),i=r(93330),n=r(42023),o=r.n(n),l=r(11185),d=r.n(l);let u=new(d()).Schema({name:String,email:String,password:String,role:{type:String,default:"USER"},isActive:{type:Boolean,default:!0}}),c=d().models.AuthUser||d().model("AuthUser",u),p={providers:[(0,s.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;try{await (0,a.Z)();let t=await i.Z.findOne({email:e.email.toLowerCase(),isActive:!0}).lean();if(!t||!t.password||!await o().compare(e.password,t.password))return null;return{id:t._id.toString(),email:t.email,name:t.name,role:t.role,image:t.avatar}}catch(e){return console.error("Auth error:",e),null}}})],session:{strategy:"jwt"},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.role=t.role),e),session:async({session:e,token:t})=>(e.user&&(e.user.id=t.sub,e.user.role=t.role),e),async signIn({user:e,account:t}){if(t?.provider==="google")try{await (0,a.Z)(),await i.Z.findOne({email:e.email?.toLowerCase()}).lean()||await i.Z.create({name:e.name,email:e.email?.toLowerCase(),avatar:e.image,role:"USER",isActive:!0,emailVerified:!0})}catch(e){return console.error("Google sign-in error:",e),!1}return!0}},pages:{signIn:"/login"},secret:process.env.NEXTAUTH_SECRET}},14184:(e,t,r)=>{r.d(t,{Z:()=>o});var s=r(11185),a=r.n(s);let i=process.env.MONGODB_URI;if(!i)throw Error("Please define the MONGODB_URI environment variable inside .env.local (development) or .env.production (production)");let n=global.mongoose;n||(n=global.mongoose={conn:null,promise:null});let o=async function(){if(n.conn)return n.conn;n.promise||(n.promise=a().connect(i,{bufferCommands:!1}).then(e=>e));try{n.conn=await n.promise}catch(e){throw n.promise=null,e}return n.conn}},78638:(e,t,r)=>{r.d(t,{Z:()=>n});var s=r(11185),a=r.n(s);let i=new s.Schema({title:{type:String,required:[!0,"Story title is required"],trim:!0,maxlength:[200,"Title cannot exceed 200 characters"]},slug:{type:String,required:[!0,"Slug is required"],unique:!0,lowercase:!0,trim:!0},content:{type:String,required:[!0,"Content is required"],minlength:[100,"Content must be at least 100 characters"]},excerpt:{type:String,required:[!0,"Excerpt is required"],maxlength:[300,"Excerpt cannot exceed 300 characters"]},coverImage:{type:String,required:[!0,"Cover image is required"]},images:[{type:String}],tags:[{type:String,trim:!0,lowercase:!0}],category:{type:String,enum:["TRAVEL","ADVENTURE","CULTURE","FOOD","TIPS","GUIDE"],required:[!0,"Category is required"]},userId:{type:s.Schema.Types.ObjectId,ref:"User",required:[!0,"User ID is required"]},eventId:{type:s.Schema.Types.ObjectId,ref:"Event"},isPublished:{type:Boolean,default:!1},isFeatured:{type:Boolean,default:!1},readTime:{type:Number,required:!0,min:[1,"Read time must be at least 1 minute"]},views:{type:Number,default:0,min:[0,"Views cannot be negative"]},likes:[{type:s.Schema.Types.ObjectId,ref:"User"}],seo:{metaTitle:{type:String,maxlength:[60,"Meta title cannot exceed 60 characters"]},metaDescription:{type:String,maxlength:[160,"Meta description cannot exceed 160 characters"]},keywords:[String]},publishedAt:{type:Date}},{timestamps:!0});i.pre("save",function(e){this.isPublished&&!this.publishedAt&&(this.publishedAt=new Date),e()}),i.pre("save",function(e){if(this.content){let e=this.content.split(/\s+/).length;this.readTime=Math.ceil(e/200)}e()}),i.index({slug:1}),i.index({userId:1}),i.index({category:1}),i.index({isPublished:1}),i.index({isFeatured:1}),i.index({tags:1}),i.index({publishedAt:-1}),i.index({views:-1});let n=a().models.Story||a().model("Story",i)},93330:(e,t,r)=>{r.d(t,{Z:()=>n});var s=r(11185),a=r.n(s);let i=new s.Schema({name:{type:String,required:[!0,"Name is required"],trim:!0,maxlength:[100,"Name cannot exceed 100 characters"]},email:{type:String,required:[!0,"Email is required"],unique:!0,lowercase:!0,trim:!0,match:[/^[^\s@]+@[^\s@]+\.[^\s@]+$/,"Please enter a valid email"]},password:{type:String,required:[!0,"Password is required"],minlength:[6,"Password must be at least 6 characters"]},role:{type:String,enum:["USER","ADMIN","GUIDE"],default:"USER"},avatar:{type:String,default:null},phone:{type:String,trim:!0},dateOfBirth:{type:Date},address:{street:String,city:String,state:String,country:String,zipCode:String},emergencyContact:{name:String,phone:String,relationship:String},preferences:{newsletter:{type:Boolean,default:!0},notifications:{type:Boolean,default:!0}},isActive:{type:Boolean,default:!0},emailVerified:{type:Boolean,default:!1},isVerified:{type:Boolean,default:!1},verifiedAt:{type:Date},verifiedBy:{type:s.Schema.Types.ObjectId,ref:"User"},isBanned:{type:Boolean,default:!1},banReason:{type:String,trim:!0},bannedAt:{type:Date},bannedBy:{type:s.Schema.Types.ObjectId,ref:"User"},roleChangedAt:{type:Date},roleChangedBy:{type:s.Schema.Types.ObjectId,ref:"User"},passwordResetRequired:{type:Boolean,default:!1},passwordResetRequestedAt:{type:Date},passwordResetRequestedBy:{type:s.Schema.Types.ObjectId,ref:"User"},createdBy:{type:s.Schema.Types.ObjectId,ref:"User"},updatedBy:{type:s.Schema.Types.ObjectId,ref:"User"}},{timestamps:!0});i.index({email:1}),i.index({role:1}),i.index({isActive:1}),i.index({isVerified:1}),i.index({isBanned:1}),i.index({createdAt:-1});let n=a().models.User||a().model("User",i)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[9276,5972,2023,1482,1790],()=>r(69140));module.exports=s})();