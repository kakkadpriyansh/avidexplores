"use strict";(()=>{var e={};e.id=3873,e.ids=[3873],e.modules={11185:e=>{e.exports=require("mongoose")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},95670:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>q,patchFetch:()=>x,requestAsyncStorage:()=>y,routeModule:()=>g,serverHooks:()=>S,staticGenerationAsyncStorage:()=>f});var i={};r.r(i),r.d(i,{GET:()=>p,POST:()=>m});var a=r(49303),n=r(88716),s=r(60670),o=r(87070),d=r(14184),u=r(84174),l=r(75571),c=r(95456);async function p(e){try{await (0,d.Z)();let{searchParams:t}=new URL(e.url),r=parseInt(t.get("page")||"1"),i=parseInt(t.get("limit")||"10"),a=t.get("category"),n=t.get("difficulty"),s=t.get("location"),p=t.get("featured"),m=t.get("search"),g=t.get("sortBy")||"createdAt",y=t.get("sortOrder")||"desc",f="true"===t.get("admin");if(f){let e=await (0,l.getServerSession)(c.Lz),t=e?.user?.role;if(!e||!t||"ADMIN"!==t&&"GUIDE"!==t)return o.NextResponse.json({success:!1,error:"Unauthorized"},{status:403})}let S={};f||(S.isActive=!0),a&&(S.category=a),n&&(S.difficulty=n),s&&(S["location.state"]=RegExp(s,"i")),"true"===p&&(S.isFeatured=!0),m&&(S.$or=[{title:RegExp(m,"i")},{description:RegExp(m,"i")},{tags:RegExp(m,"i")}]);let q=(r-1)*i,x=await u.Z.find(S).populate("guide","name email").populate("createdBy","name email").sort({[g]:"desc"===y?-1:1}).skip(q).limit(i),h=await u.Z.countDocuments(S);return o.NextResponse.json({success:!0,data:x,pagination:{page:r,limit:i,total:h,pages:Math.ceil(h/i)}})}catch(e){return console.error("Error fetching events:",e),o.NextResponse.json({success:!1,error:"Failed to fetch events"},{status:500})}}async function m(e){try{let t=await (0,l.getServerSession)(c.Lz),r=t?.user?.role;if(!t||!r||"ADMIN"!==r&&"GUIDE"!==r)return o.NextResponse.json({success:!1,error:"Unauthorized"},{status:403});await (0,d.Z)();let{title:i,description:a,shortDescription:n,price:s,dates:p,availableMonths:m,availableDates:g,itinerary:y,inclusions:f,exclusions:S,preparation:q,category:x,difficulty:h,images:v,location:w,duration:b,maxParticipants:R,minParticipants:E,ageLimit:N,season:I,tags:U,highlights:A,thingsToCarry:D,guide:B}=await e.json(),T=i.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");if(await u.Z.findOne({slug:T}))return o.NextResponse.json({success:!1,error:"Event with this title already exists"},{status:400});let j=y?.map((e,t)=>({day:e.day||t+1,title:e.title||`Day ${t+1}`,location:e.location||"",description:e.description||"No description provided",activities:e.activities||[],meals:e.meals||[],accommodation:e.accommodation||""}))||[],O={title:i,slug:T,description:a,shortDescription:n,price:s,dates:p||[],availableMonths:m||[],availableDates:g||[],itinerary:j,inclusions:f?.filter(e=>""!==e.trim())||[],exclusions:S?.filter(e=>""!==e.trim())||[],preparation:q||{physicalRequirements:"",medicalRequirements:"",experienceLevel:"",safetyGuidelines:[],additionalNotes:""},category:x,difficulty:h,images:v?.filter(e=>""!==e.trim())||[],location:"string"==typeof w?{name:w,state:"Unknown",country:"India"}:w,duration:parseInt(b)||1,maxParticipants:parseInt(R)||10,minParticipants:parseInt(E)||1,ageLimit:N||{min:18,max:65},season:I||[],tags:U||[],highlights:A||[],thingsToCarry:D||[],guide:B||t.user.id,createdBy:t.user.id,isActive:!0},M=new u.Z(O);await M.save();let P=await u.Z.findById(M._id).populate("guide","name email").populate("createdBy","name email");return o.NextResponse.json({success:!0,data:P,message:"Event created successfully"},{status:201})}catch(e){return console.error("Error creating event:",e),o.NextResponse.json({success:!1,error:"Failed to create event"},{status:500})}}let g=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/events/route",pathname:"/api/events",filename:"route",bundlePath:"app/api/events/route"},resolvedPagePath:"/Users/priyanshkakkad/Downloads/avid-explores-frontend-main/src/app/api/events/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:y,staticGenerationAsyncStorage:f,serverHooks:S}=g,q="/api/events/route";function x(){return(0,s.patchFetch)({serverHooks:S,staticGenerationAsyncStorage:f})}},95456:(e,t,r)=>{r.d(t,{Lz:()=>p}),r(41482);var i=r(53797),a=r(14184),n=r(93330),s=r(42023),o=r.n(s),d=r(11185),u=r.n(d);let l=new(u()).Schema({name:String,email:String,password:String,role:{type:String,default:"USER"},isActive:{type:Boolean,default:!0}}),c=u().models.AuthUser||u().model("AuthUser",l),p={providers:[(0,i.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;try{await (0,a.Z)();let t=await n.Z.findOne({email:e.email.toLowerCase(),isActive:!0}).lean();if(!t||!t.password||!await o().compare(e.password,t.password))return null;return{id:t._id.toString(),email:t.email,name:t.name,role:t.role,image:t.avatar}}catch(e){return console.error("Auth error:",e),null}}})],session:{strategy:"jwt"},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.role=t.role),e),session:async({session:e,token:t})=>(e.user&&(e.user.id=t.sub,e.user.role=t.role),e),async signIn({user:e,account:t}){if(t?.provider==="google")try{await (0,a.Z)(),await n.Z.findOne({email:e.email?.toLowerCase()}).lean()||await n.Z.create({name:e.name,email:e.email?.toLowerCase(),avatar:e.image,role:"USER",isActive:!0,emailVerified:!0})}catch(e){return console.error("Google sign-in error:",e),!1}return!0}},pages:{signIn:"/login"},secret:process.env.NEXTAUTH_SECRET}},14184:(e,t,r)=>{r.d(t,{Z:()=>o});var i=r(11185),a=r.n(i);let n=process.env.MONGODB_URI;if(!n)throw Error("Please define the MONGODB_URI environment variable inside .env.local (development) or .env.production (production)");let s=global.mongoose;s||(s=global.mongoose={conn:null,promise:null});let o=async function(){if(s.conn)return s.conn;s.promise||(s.promise=a().connect(n,{bufferCommands:!1}).then(e=>e));try{s.conn=await s.promise}catch(e){throw s.promise=null,e}return s.conn}},84174:(e,t,r)=>{r.d(t,{Z:()=>s});var i=r(11185),a=r.n(i);let n=new i.Schema({title:{type:String,required:[!0,"Event title is required"],trim:!0,maxlength:[200,"Title cannot exceed 200 characters"]},slug:{type:String,required:[!0,"Slug is required"],unique:!0,lowercase:!0,trim:!0},description:{type:String,required:[!0,"Description is required"],maxlength:[2e3,"Description cannot exceed 2000 characters"]},shortDescription:{type:String,required:[!0,"Short description is required"],maxlength:[500,"Short description cannot exceed 500 characters"]},price:{type:Number,required:[!0,"Price is required"],min:[0,"Price cannot be negative"]},dates:[{type:Date,required:!0}],availableMonths:[{type:String,required:!1}],availableDates:[{month:{type:String,required:!0},year:{type:Number,required:!0},dates:[{type:Number,required:!0}],location:{type:String,required:!1}}],itinerary:[{day:{type:Number,required:!0},title:{type:String,required:!0,trim:!0},location:{type:String,required:!1},description:{type:String,required:!0},activities:[String],meals:[String],accommodation:String}],inclusions:[{type:String,required:!0}],exclusions:[{type:String,required:!0}],preparation:{physicalRequirements:{type:String,default:""},medicalRequirements:{type:String,default:""},experienceLevel:{type:String,default:""},safetyGuidelines:[{type:String}],additionalNotes:{type:String,default:""}},category:{type:String,enum:["TREKKING","CAMPING","WILDLIFE","CULTURAL","ADVENTURE","SPIRITUAL"],required:[!0,"Category is required"]},difficulty:{type:String,enum:["EASY","MODERATE","DIFFICULT","EXTREME"],required:[!0,"Difficulty level is required"]},images:[{type:String,required:!0}],location:{name:{type:String,required:!0},state:{type:String,required:!0},country:{type:String,required:!0,default:"India"},coordinates:{latitude:Number,longitude:Number}},duration:{type:Number,required:[!0,"Duration is required"],min:[1,"Duration must be at least 1 day"]},maxParticipants:{type:Number,required:[!0,"Maximum participants is required"],min:[1,"Must allow at least 1 participant"]},minParticipants:{type:Number,required:[!0,"Minimum participants is required"],min:[1,"Must require at least 1 participant"]},ageLimit:{min:{type:Number,required:!0,min:[0,"Minimum age cannot be negative"]},max:{type:Number,required:!0,max:[100,"Maximum age cannot exceed 100"]}},season:[{type:String,enum:["SPRING","SUMMER","MONSOON","AUTUMN","WINTER"]}],tags:[String],highlights:[String],thingsToCarry:[String],guide:{type:i.Schema.Types.ObjectId,ref:"User",required:!0},isActive:{type:Boolean,default:!0},isFeatured:{type:Boolean,default:!1},createdBy:{type:i.Schema.Types.ObjectId,ref:"User",required:!0}},{timestamps:!0});n.index({slug:1}),n.index({category:1}),n.index({difficulty:1}),n.index({isActive:1}),n.index({isFeatured:1}),n.index({"location.state":1}),n.index({dates:1}),n.index({price:1});let s=a().models.Event||a().model("Event",n)},93330:(e,t,r)=>{r.d(t,{Z:()=>s});var i=r(11185),a=r.n(i);let n=new i.Schema({name:{type:String,required:[!0,"Name is required"],trim:!0,maxlength:[100,"Name cannot exceed 100 characters"]},email:{type:String,required:[!0,"Email is required"],unique:!0,lowercase:!0,trim:!0,match:[/^[^\s@]+@[^\s@]+\.[^\s@]+$/,"Please enter a valid email"]},password:{type:String,required:[!0,"Password is required"],minlength:[6,"Password must be at least 6 characters"]},role:{type:String,enum:["USER","ADMIN","GUIDE"],default:"USER"},avatar:{type:String,default:null},phone:{type:String,trim:!0},dateOfBirth:{type:Date},address:{street:String,city:String,state:String,country:String,zipCode:String},emergencyContact:{name:String,phone:String,relationship:String},preferences:{newsletter:{type:Boolean,default:!0},notifications:{type:Boolean,default:!0}},isActive:{type:Boolean,default:!0},emailVerified:{type:Boolean,default:!1},isVerified:{type:Boolean,default:!1},verifiedAt:{type:Date},verifiedBy:{type:i.Schema.Types.ObjectId,ref:"User"},isBanned:{type:Boolean,default:!1},banReason:{type:String,trim:!0},bannedAt:{type:Date},bannedBy:{type:i.Schema.Types.ObjectId,ref:"User"},roleChangedAt:{type:Date},roleChangedBy:{type:i.Schema.Types.ObjectId,ref:"User"},passwordResetRequired:{type:Boolean,default:!1},passwordResetRequestedAt:{type:Date},passwordResetRequestedBy:{type:i.Schema.Types.ObjectId,ref:"User"},createdBy:{type:i.Schema.Types.ObjectId,ref:"User"},updatedBy:{type:i.Schema.Types.ObjectId,ref:"User"}},{timestamps:!0});n.index({email:1}),n.index({role:1}),n.index({isActive:1}),n.index({isVerified:1}),n.index({isBanned:1}),n.index({createdAt:-1});let s=a().models.User||a().model("User",n)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[9276,5972,2023,1482,1790],()=>r(95670));module.exports=i})();