"use strict";(()=>{var e={};e.id=994,e.ids=[994],e.modules={11185:e=>{e.exports=require("mongoose")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},39610:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>w,requestAsyncStorage:()=>g,routeModule:()=>y,serverHooks:()=>h,staticGenerationAsyncStorage:()=>f});var s={};r.r(s),r.d(s,{GET:()=>p,POST:()=>m});var a=r(49303),n=r(88716),i=r(60670),o=r(87070),d=r(14184),l=r(9756),c=r(75571),u=r(95456);async function p(e){try{await (0,d.Z)();let{searchParams:t}=new URL(e.url),r=parseInt(t.get("page")||"1"),s=parseInt(t.get("limit")||"20"),a="true"===t.get("admin");if(a){let e=await (0,c.getServerSession)(u.Lz),t=e?.user?.role;if(!e||!t||"ADMIN"!==t)return o.NextResponse.json({success:!1,error:"Unauthorized"},{status:403})}let n={};a||(n.isActive=!0);let i=(r-1)*s,p=await l.Z.find(n).sort({order:1,createdAt:-1}).skip(i).limit(s),m=await l.Z.countDocuments(n);return o.NextResponse.json({success:!0,data:p,pagination:{page:r,limit:s,total:m,pages:Math.ceil(m/s)}})}catch(e){return console.error("Error fetching destination cards:",e),o.NextResponse.json({success:!1,error:"Failed to fetch destination cards"},{status:500})}}async function m(e){try{let t=await (0,c.getServerSession)(u.Lz),r=t?.user?.role,s=t?.user?.id;if(!t||!r||"ADMIN"!==r)return o.NextResponse.json({success:!1,error:"Unauthorized"},{status:403});await (0,d.Z)();let{title:a,photo:n,link:i,isActive:p=!0,order:m=0}=await e.json();if(!n||!i)return o.NextResponse.json({success:!1,error:"Photo and link are required"},{status:400});let y=new l.Z({title:a,photo:n,link:i,isActive:p,order:m,createdBy:s});return await y.save(),o.NextResponse.json({success:!0,data:y,message:"Destination card created successfully"},{status:201})}catch(e){if(console.error("Error creating destination card:",e),"ValidationError"===e.name)return o.NextResponse.json({success:!1,error:e.message},{status:400});return o.NextResponse.json({success:!1,error:"Failed to create destination card"},{status:500})}}let y=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/destination-cards/route",pathname:"/api/destination-cards",filename:"route",bundlePath:"app/api/destination-cards/route"},resolvedPagePath:"/Users/priyanshkakkad/Downloads/avid-explores-frontend-main/src/app/api/destination-cards/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:f,serverHooks:h}=y,x="/api/destination-cards/route";function w(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:f})}},95456:(e,t,r)=>{r.d(t,{Lz:()=>p}),r(41482);var s=r(53797),a=r(14184),n=r(93330),i=r(42023),o=r.n(i),d=r(11185),l=r.n(d);let c=new(l()).Schema({name:String,email:String,password:String,role:{type:String,default:"USER"},isActive:{type:Boolean,default:!0}}),u=l().models.AuthUser||l().model("AuthUser",c),p={providers:[(0,s.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;try{await (0,a.Z)();let t=await n.Z.findOne({email:e.email.toLowerCase(),isActive:!0}).lean();if(!t||!t.password||!await o().compare(e.password,t.password))return null;return{id:t._id.toString(),email:t.email,name:t.name,role:t.role,image:t.avatar}}catch(e){return console.error("Auth error:",e),null}}})],session:{strategy:"jwt"},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.role=t.role),e),session:async({session:e,token:t})=>(e.user&&(e.user.id=t.sub,e.user.role=t.role),e),async signIn({user:e,account:t}){if(t?.provider==="google")try{await (0,a.Z)(),await n.Z.findOne({email:e.email?.toLowerCase()}).lean()||await n.Z.create({name:e.name,email:e.email?.toLowerCase(),avatar:e.image,role:"USER",isActive:!0,emailVerified:!0})}catch(e){return console.error("Google sign-in error:",e),!1}return!0}},pages:{signIn:"/login"},secret:process.env.NEXTAUTH_SECRET}},14184:(e,t,r)=>{r.d(t,{Z:()=>o});var s=r(11185),a=r.n(s);let n=process.env.MONGODB_URI;if(!n)throw Error("Please define the MONGODB_URI environment variable inside .env.local (development) or .env.production (production)");let i=global.mongoose;i||(i=global.mongoose={conn:null,promise:null});let o=async function(){if(i.conn)return i.conn;i.promise||(i.promise=a().connect(n,{bufferCommands:!1}).then(e=>e));try{i.conn=await i.promise}catch(e){throw i.promise=null,e}return i.conn}},9756:(e,t,r)=>{r.d(t,{Z:()=>i});var s=r(11185),a=r.n(s);let n=new s.Schema({title:{type:String,required:!1,trim:!0,maxlength:[100,"Title cannot exceed 100 characters"]},photo:{type:String,required:[!0,"Photo URL is required"],trim:!0},link:{type:String,required:[!0,"Link is required"],trim:!0},isActive:{type:Boolean,default:!0},order:{type:Number,default:0},createdBy:{type:s.Schema.Types.ObjectId,ref:"User",required:!0}},{timestamps:!0});n.index({isActive:1,order:1}),n.index({createdBy:1});let i=a().models.DestinationCard||a().model("DestinationCard",n)},93330:(e,t,r)=>{r.d(t,{Z:()=>i});var s=r(11185),a=r.n(s);let n=new s.Schema({name:{type:String,required:[!0,"Name is required"],trim:!0,maxlength:[100,"Name cannot exceed 100 characters"]},email:{type:String,required:[!0,"Email is required"],unique:!0,lowercase:!0,trim:!0,match:[/^[^\s@]+@[^\s@]+\.[^\s@]+$/,"Please enter a valid email"]},password:{type:String,required:[!0,"Password is required"],minlength:[6,"Password must be at least 6 characters"]},role:{type:String,enum:["USER","ADMIN","GUIDE"],default:"USER"},avatar:{type:String,default:null},phone:{type:String,trim:!0},dateOfBirth:{type:Date},address:{street:String,city:String,state:String,country:String,zipCode:String},emergencyContact:{name:String,phone:String,relationship:String},preferences:{newsletter:{type:Boolean,default:!0},notifications:{type:Boolean,default:!0}},isActive:{type:Boolean,default:!0},emailVerified:{type:Boolean,default:!1},isVerified:{type:Boolean,default:!1},verifiedAt:{type:Date},verifiedBy:{type:s.Schema.Types.ObjectId,ref:"User"},isBanned:{type:Boolean,default:!1},banReason:{type:String,trim:!0},bannedAt:{type:Date},bannedBy:{type:s.Schema.Types.ObjectId,ref:"User"},roleChangedAt:{type:Date},roleChangedBy:{type:s.Schema.Types.ObjectId,ref:"User"},passwordResetRequired:{type:Boolean,default:!1},passwordResetRequestedAt:{type:Date},passwordResetRequestedBy:{type:s.Schema.Types.ObjectId,ref:"User"},createdBy:{type:s.Schema.Types.ObjectId,ref:"User"},updatedBy:{type:s.Schema.Types.ObjectId,ref:"User"}},{timestamps:!0});n.index({email:1}),n.index({role:1}),n.index({isActive:1}),n.index({isVerified:1}),n.index({isBanned:1}),n.index({createdAt:-1});let i=a().models.User||a().model("User",n)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[9276,5972,2023,1482,1790],()=>r(39610));module.exports=s})();